{% extends "base.html" %}

{% block content %}
<section class="space-y-8">
  <!-- 상단 타이틀 영역 -->
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-slate-900">블로그 원고 자동 생성</h1>
      <p class="mt-2 text-sm text-slate-500">
        상위 노출 블로그 패턴을 기반으로, 핵심 키워드와 제약 조건을 반영한 네이버 블로그용 원고를 자동으로 생성합니다.
      </p>
    </div>
    <div class="hidden sm:flex flex-col items-end text-xs text-slate-500">
      <span class="font-medium text-slate-700">
        {{ user.full_name or user.email }}
      </span>
      <span>로그인됨</span>
    </div>
  </div>

  <!-- 에러 메시지 -->
  {% if error %}
  <div class="rounded-lg bg-rose-50 border border-rose-200 px-4 py-3 text-sm text-rose-800">
    {{ error }}
  </div>
  {% endif %}

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
    <!-- ===== 왼쪽: 입력 폼 ===== -->
    <form
    method="post"
    action="/generator"
    enctype="multipart/form-data"
    class="space-y-6 bg-white border border-slate-200 rounded-xl px-5 py-6 shadow-sm"
    >
      <!-- 1. 핵심 정보 -->
      <section class="space-y-4">
        <h2 class="text-sm font-semibold text-emerald-700">
          1. 핵심 정보
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="space-y-1 sm:col-span-2">
            <label for="core_keyword" class="block text-sm font-medium text-slate-700">
              핵심 키워드 <span class="text-rose-500">*</span>
            </label>
            <input
              type="text"
              id="core_keyword"
              name="core_keyword"
              required
              value="{{ form.core_keyword }}"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="예: pdnm앰플, 안산 순대 맛집"
            />
            <p class="text-[11px] text-slate-400">
              상위 노출을 노리는 최우선 핵심 키워드를 1~2개 정도만 입력하는 것을 권장합니다.
            </p>
          </div>

          <div class="space-y-1">
            <label for="product_name" class="block text-sm font-medium text-slate-700">
              제품명
            </label>
            <input
              type="text"
              id="product_name"
              name="product_name"
              value="{{ form.product_name }}"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="예: 프로바이오덤 3D 리프팅 크림"
            />
          </div>

          <div class="space-y-1">
            <label for="brand" class="block text-sm font-medium text-slate-700">
              브랜드
            </label>
            <input
              type="text"
              id="brand"
              name="brand"
              value="{{ form.brand }}"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="예: BOH BIO HEAL"
            />
          </div>
        </div>
      </section>

      <!-- 2. 타겟 및 톤앤매너 -->
      <section class="space-y-4">
        <h2 class="text-sm font-semibold text-emerald-700">
          2. 타겟 및 톤앤매너
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="space-y-1 sm:col-span-2">
            <label for="target_audience" class="block text-sm font-medium text-slate-700">
              타겟 독자
            </label>
            <input
              type="text"
              id="target_audience"
              name="target_audience"
              value="{{ form.target_audience }}"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="예: 건성/민감성 20~30대, 속건조 고민"
            />
          </div>

          <div class="space-y-1">
            <label for="intent" class="block text-sm font-medium text-slate-700">
              글의 의도
            </label>
            <select
              id="intent"
              name="intent"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
            >
              <option value="">선택 없음</option>
              <option value="정보형">정보형</option>
              <option value="리뷰형">리뷰형</option>
              <option value="후기형">후기형</option>
              <option value="비교형">비교형</option>
              <option value="구매유도형">구매 유도형</option>
            </select>
          </div>

          <div class="space-y-1">
            <label for="persona" class="block text-sm font-medium text-slate-700">
              작성자 페르소나
            </label>
            <select
              id="persona"
              name="persona"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
            >
              <option value="">선택 없음</option>
              <option value="개인블로거">개인블로거</option>
              <option value="브랜드마케터">브랜드 마케터</option>
              <option value="전문가">전문가(피부관리사·트레이너 등)</option>
              <option value="일반소비자">일반 소비자</option>
            </select>
          </div>

          <div class="space-y-1 sm:col-span-2">
            <label for="tone" class="block text-sm font-medium text-slate-700">
              톤앤매너
            </label>
            <!-- name="tone" 으로 유지 (백엔드 기존 필드 호환) -->
            <select
              id="tone"
              name="tone"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
            >
              <option value="">선택 없음</option>
              <option value="친근하고 전문적인 톤">친근+전문</option>
              <option value="담백하고 객관적인 톤">담백+객관</option>
              <option value="공감가고 따뜻한 톤">공감+친절</option>
              <option value="공식적이고 신뢰감 있는 톤">공식+신뢰</option>
            </select>
            <p class="text-[11px] text-slate-400">
              실제 상위 노출되고 있는 글의 말투와 비슷하게 맞추고 싶은 스타일을 선택하세요.
            </p>
          </div>
        </div>
      </section>

      <!-- 3. 콘텐츠 구성 및 제약 -->
      <section class="space-y-4">
        <h2 class="text-sm font-semibold text-emerald-700">
          3. 콘텐츠 구성 및 제약
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="space-y-1">
            <label for="must_keywords" class="block text-sm font-medium text-slate-700">
              필수 포함 키워드
            </label>
            <textarea
              id="must_keywords"
              name="must_keywords"
              rows="3"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="콤마(,)로 구분하여 입력 (예: L-PDRN, 유산균 유래, 민감성 피부)"
            >{{ form.must_keywords }}</textarea>
          </div>

          <div class="space-y-1">
            <label for="must_headings" class="block text-sm font-medium text-slate-700">
              필수 포함 소제목
            </label>
            <textarea
              id="must_headings"
              name="must_headings"
              rows="3"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="콤마(,)로 구분하여 입력 (예: 장점, 사용 포인트, 이런 분께 추천)"
            >{{ form.must_headings }}</textarea>
          </div>

          <div class="space-y-1">
            <label for="cta_text" class="block text-sm font-medium text-slate-700">
              CTA (Call to Action)
            </label>
            <input
              type="text"
              id="cta_text"
              name="cta_text"
              value="{{ form.cta_text | default('구독') }}"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="예: 구독, 상담 문의 남기기, 더보기 클릭 유도 문구"
            />
          </div>

          <div class="space-y-1">
            <label for="banned_terms" class="block text-sm font-medium text-slate-700">
              금지 단어
            </label>
            <textarea
              id="banned_terms"
              name="banned_terms"
              rows="3"
              class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              placeholder="콤마(,)로 구분하여 입력 (예: 효과, 효능, 개선, 치료, 임상)"
            >{{ form.banned_terms }}</textarea>
          </div>
        </div>

        <div class="space-y-1">
          <label for="additional_instructions" class="block text-sm font-medium text-slate-700">
            추가 요청사항 (선택)
          </label>
          <textarea
            id="additional_instructions"
            name="additional_instructions"
            rows="3"
            class="block w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
            placeholder="예: 너무 광고 같지 않게, 경험담을 중심으로 써주세요. 상위 노출된 블로그의 구조를 최대한 따라가 주세요."
          >{{ form.additional_instructions }}</textarea>
        </div>

        <div class="space-y-1">
          <label class="block text-sm font-medium text-slate-700">
            제품 상세 정보 (.txt 파일)
          </label>
          <!-- 아직 백엔드는 파일 처리를 안 해서, 1단계에서는 UI만 먼저 보여주자 -->
          <div class="flex items-center gap-3">
            <input
              type="file"
              id="product_detail_file"
              name="product_detail_file"
              class="block w-full text-xs text-slate-500 file:mr-3 file:rounded-md file:border file:border-slate-300 file:bg-slate-50 file:px-3 file:py-1.5 file:text-xs file:font-medium file:text-slate-700 hover:file:bg-slate-100"
            />
          </div>
          <p class="text-[11px] text-slate-400">
            제품 설명, 성분, 사용 방법 등이 정리된 .txt 파일이 있다면 업로드하세요. (실제 내용 반영은 다음 단계에서 구현 예정)
          </p>
        </div>
      </section>

      <button
        type="submit"
        class="w-full inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1"
      >
        상위 노출 패턴으로 원고 생성하기
      </button>

      <p class="text-[11px] text-slate-400">
        생성된 원고는 자동으로 내 계정에 저장되며, 향후 마이페이지에서 상위 노출 패턴 분석/관리 기능과 연동할 예정입니다.
      </p>
    </form>

    <!-- ===== 오른쪽: 결과 영역 ===== -->
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <h2 class="text-sm font-semibold text-slate-800">
          생성된 원고
        </h2>
        {% if result and result.article_id %}
        <span class="text-[11px] text-slate-400">
          ID: {{ result.article_id }}
        </span>
        {% endif %}
      </div>

      {% if result %}
      <div class="bg-white border border-slate-200 rounded-xl px-4 py-3 shadow-sm">
        <textarea
          readonly
          class="w-full h-[560px] text-sm leading-relaxed text-slate-800 border-0 focus:outline-none resize-none"
        >{{ result.content }}</textarea>
      </div>
      {% else %}
      <div class="bg-slate-50 border border-dashed border-slate-300 rounded-xl px-4 py-8 text-sm text-slate-500 flex items-center justify-center text-center">
        왼쪽에서 조건을 입력하고 [상위 노출 패턴으로 원고 생성하기]를 누르면, 여기에서 결과를 확인할 수 있습니다.
      </div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}